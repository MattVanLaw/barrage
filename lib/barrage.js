!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{constructor(t){this.context=t.context,this.width=t.width,this.height=t.height,this.image=t.image,this.x=t.x,this.y=t.y,this.cropX=t.cropX,this.cropY=t.cropY,this.frameWidth=t.frameWidth,this.frameHeight=t.frameHeight,this.update=this.update.bind(this),this.frameIndex=0,this.tickCount=0,this.ticksPerFrame=t.ticksPerFrame||0,this.numberOfFrames=t.numberOfFrames||1,this.loop=t.loop}render(){this.context.drawImage(this.image,this.cropX,this.cropY,this.frameWidth,this.frameHeight,this.x,this.y,this.width,this.height)}update(){this.tickCount+=1,this.tickCount>this.ticksPerFrame&&(this.tickCount=0,this.frameIndex<this.numberOfFrames-1?this.frameIndex+=1:this.loop&&(this.frameIndex=0))}};var h=class{constructor(t,e,i){this.canvas=i,this.ctx=e,this.x=t[0],this.y=t[1],this.width=4,this.height=17,this.bulletImage=new Image,this.bulletImage.src="assets/bullet.png",this.render=this.render.bind(this)}render(){new s({context:this.canvas.getContext("2d"),cropX:0,cropY:0,x:this.x-1,y:this.y-1,width:7,height:20,image:this.bulletImage,frameWidth:600,frameHeight:700}).render()}update(t){this.x+=t[0],this.y-=t[1]}draw(){this.ctx.beginPath(),this.ctx.rect(this.x,this.y,this.width,this.height),this.ctx.closePath()}};const r=document.getElementById("myCanvas");var n={1:{image:"assets/ship.png",default:{width:30,height:20,x:(r.width-28)/2,y:r.height-28,hp:10,weapon:[0,6],bulletCount:1},quick:{width:30,height:20,weapon:[0,10],bulletCount:1},machineGun:{width:30,height:20,weapon:[0,6],bulletCount:15}},2:{default:{width:30,height:20,x:(r.width-28)/2,y:r.height-28,hp:10,weapon:[0,6],bulletCount:1},quick:{width:30,height:20,weapon:[0,10],bulletCount:1},machineGun:{width:30,height:20,weapon:[0,6],bulletCount:15}}};var a=class{constructor(t,e,i,s){this.canvas=t,this.ctx=e,this.type=i,this.props=n[i][s],this.shipTree=n[i],this.fire=this.fire.bind(this),this.reload=this.reload.bind(this),this._buildBullets=this._buildBullets.bind(this),this.bullets=this._buildBullets(),this.createSprite=this.createSprite.bind(this),this.createLeftSprite=this.createLeftSprite.bind(this),this.createRightSprite=this.createRightSprite.bind(this),this.changeBulletCount=this.changeBulletCount.bind(this)}changeBulletCount(t){this.props.bulletCount=t,this.bullets=this._buildBullets()}_buildBullets(){const t=[];for(let e=0;e<this.props.bulletCount;e++)t.push(new h([this.props.x,this.props.y],this.ctx,this.canvas));return t}createSprite(){let t=new Image;return t.src=this.shipTree.image,new s({context:this.canvas.getContext("2d"),cropX:0,cropY:258,x:(this.canvas.width-28)/2-17,y:this.canvas.height-28-12.5,width:this.props.width+20,height:this.props.height+20,image:t,frameWidth:60,frameHeight:42})}createLeftSprite(){let t=new Image;return t.src=this.shipTree.image,new s({context:this.canvas.getContext("2d"),cropX:0,cropY:321,x:this.canvas.width-28-12,y:this.canvas.height-28-12.5,width:this.props.width+20,height:this.props.height+20,image:t,frameWidth:60,frameHeight:43})}createRightSprite(){let t=new Image;return t.src=this.shipTree.image,new s({context:this.canvas.getContext("2d"),cropX:0,cropY:385,x:this.canvas.width/2,y:this.canvas.height-28-12.5,width:this.props.width+20,height:this.props.height+20,image:t,frameWidth:60,frameHeight:42})}fire(){this.bullets.forEach(t=>{t.render(),t.draw(),t.update(this.props.weapon)})}reload(){this.bullets.forEach((t,e)=>{t.y<2&&(t.x=this.props.x+this.props.width/2-2,t.y=this.props.y-(this.props.bulletCount-e+2))})}draw(){this.createSprite(),this.createLeftSprite(),this.createRightSprite(),this.ctx.beginPath(),this.ctx.rect(this.props.x,this.props.y,this.props.width,this.props.height),this.ctx.closePath()}};var o=(t,e)=>t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y;class d{constructor(t,e,i,s){this.x=t[0],this.y=t[1],this.width=e,this.height=i,this.ctx=s,this.renderExplosion=this.renderExplosion.bind(this),this.animateExplosion=this.animateExplosion.bind(this),this.update=this.update.bind(this),this.randomX=2e3*Math.random()+1,this.randomY=2e3*Math.random()+1}static buildAllEnemies(t,e){const i=[],s=[],h=[],r=[];for(let n=0;n<1e3;n++){let n=Math.floor(Math.random()*(t.width-60)+15);i.push(new d([n,-45],15,35,e)),n=Math.floor(Math.random()*(t.width-60)+15),s.push(new d([n,-45],15,35,e));let a=Math.floor(Math.random()*t.height)-t.height/2;h.push(new d([-60,a],50,18,e)),n=Math.floor(Math.random()*(t.width-60)+15),r.push(new d([n,12],15,35,e))}return{enemies1:i,enemies1b:s,enemies2:h,bossBullets:r}}static sprite(t,e){let i=new Image;return i.src="assets/enemy-missiles.png",new s({context:t.getContext("2d"),cropX:0,cropY:117,x:e.x-(e.width/2-5),y:e.y,width:15.4,height:42,image:i,frameWidth:31,frameHeight:126})}playerHit(t,e,i){return o(t,this)?(this.die(e),t.hp--,$w(".health").html(t.hp),i-100):i}killed(t,e,i,s,h){if(o(h,this)){return this.die(t),h.x=s.x+s.width/2-2,h.y=s.y-(2+s.bulletCount),{score:e+1e3+(i.height-s.y),dead:this}}return{score:e}}renderExplosion(t){let e=new Image;return e.src=t,new s({context:this.ctx,cropY:0,x:this.x,y:this.y,width:52,height:300,image:e,frameWidth:42,frameHeight:300})}animateExplosion(t,e){e.cropX=50.8888*t,e.x=this.x,e.y=this.y,e.render()}died(t,e,i){return t.length>0&&this.y>=i.height||t.length>0&&this.x>=i.width?(t.shift(),e-1e3):e}die(t){t.shift()}update(t){this.x+=t[0],this.y+=t[1]}draw(){this.ctx.beginPath(),this.ctx.rect(this.x,this.y,this.width,this.height),this.ctx.fillStyle="#0f380f",this.ctx.fill(),this.ctx.closePath()}}var p=d;const l=["quick","machineGun","health"];class c{constructor(t,e,i,s,h){this.type=null,this.ctx=s,this.canvas=h,this.x=t[0],this.y=t[1],this.width=e[0],this.height=e[1],this.ships=i,this.collided=!1,this.powerUp=this.powerUp.bind(this),this.resetShip=this.resetShip.bind(this),this.collide=this.collide.bind(this),this.used=this.used.bind(this)}static buildAllPowerUps(t,e,i){const s=[];for(let h=0;h<1e3;h++){let h=Math.floor(Math.random()*t.width)+1,r=l[Math.floor(Math.random()*l.length)],n=new c([h,0],[15,14],i,e,t);n.type=r,s.push(n)}return s}static sprite(t,e){let i=new Image;return i.src="assets/m-powerup.png",new s({context:t.getContext("2d"),cropX:0,cropY:0,x:e[0].x,y:e[0].y,width:20,height:20,image:i,frameWidth:50,frameHeight:50})}draw(){this.ctx.beginPath(),this.ctx.rect(this.x,this.y,this.width,this.height),this.ctx.closePath()}update(t,e){this.y+=1.5,this.y===t.height&&(this.y=0,e.shift())}powerUp(){const t=new a(this.canvas,this.ctx,1,this.type);t.props.x=this.ships[0].props.x,t.props.y=this.ships[0].props.y,t.props.hp=this.ships[0].props.hp,this.ships.push(t),this.ships.shift()}resetShip(){const t=new a(this.canvas,this.ctx,1,"default");t.props.x=this.ships[0].props.x,t.props.y=this.ships[0].props.y,t.props.hp=this.ships[0].props.hp,this.ships.push(t),this.ships.shift()}collide(t){this.ships[0].props.x<this.x+this.width&&this.ships[0].props.x+this.ships[0].props.width>this.x&&this.ships[0].props.y<this.y+this.height&&this.ships[0].props.y+this.ships[0].props.height>this.y&&("health"===this.type?(this.collided||(this.ships[0].props.hp+=5),this.collided=!0,t.shift()):(this.powerUp(),this.used(t)))}used(t){t.shift(),this.powerUp(),setTimeout(()=>this.resetShip(),5e3)}}var u=c;var m=class{constructor(t){this.sound=document.createElement("audio"),this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.style.display="none",document.body.appendChild(this.sound),this.play=(()=>this.sound.play()),this.stop=(()=>this.sound.pause())}};const g=(t,e)=>{$w(".start-menu").html("Pause"),$w(".start-menu").addClass("hidden")};let y=$w(".score").html();const x=(t,e,i)=>{if(t<=0){const t=document.getElementById("name");$w(".start-menu").html('Game Over<br/><span class="replay">Press enter to play</span>');let s="noname";return t.addEventListener("change",t=>{s=t.target.value}),document.getElementsByTagName("form")[0].addEventListener("submit",t=>{t.preventDefault(),((t,e)=>{t=t||"noname",document.getElementById("name");parseInt(y),firebase.database().ref().child("scores/").push({name:t,score:e})})(s,i),document.getElementsByTagName("form")[0].classList.add("hidden")}),$w(".start-menu").removeClass("hidden"),document.getElementsByTagName("form")[0].classList.remove("hidden"),$w(".start-menu").off("click",g),document.addEventListener("keydown",t=>{13===t.keyCode&&document.location.reload()}),cancelAnimationFrame(e),!0}};var w=(t,e,i,s)=>{t>1e3&&t<=1120&&(i[0].draw(),((t,e)=>{u.sprite(t,e).render()})(e,i),i[0].update(e,i),i[0].collide(i,"machineGun",s),1120===t&&(t=0,i.shift()))};let f=new m("8-punk-music.mp3");const b=document.getElementById("myCanvas"),v=b.getContext("2d");let C=0;const k=[new a(b,v,1,"default")];let E=k[0].props,S=0;const I=k[0].createSprite(b),P=k[0].createLeftSprite(b),M=k[0].createRightSprite(b),H=u.buildAllPowerUps(b,v,k),Y=p.buildAllEnemies(b,v),B=Y.enemies1,X=Y.enemies1b,$=Y.enemies2;let L=new Image;L.src="assets/enemy-missiles.png";const W=p.sprite(b,B[0]),O=new s({context:b.getContext("2d"),cropY:39.9,x:X[0].x-(B[0].width/2-5),y:X[0].y,width:15.4,height:42,image:L,frameWidth:31.5,frameHeight:70}),_=()=>{O.x=X[0].x-(X[0].width/2-5),O.y=X[0].y,O.cropX=0,O.render()};let A=new Image;A.src="assets/side-bullet.png";const F=new s({context:b.getContext("2d"),cropX:0,cropY:0,x:$[0].x-1,y:$[0].y-2,width:55,height:20,image:A,frameWidth:67,frameHeight:29}),T=()=>{F.x=$[0].x-1,F.y=$[0].y-2,F.render()},j=t=>{U&&E.x<b.width-E.width?E.x+=t:q&&E.x>0&&(E.x-=t),D&&E.y>0?E.y-=t:R&&E.y<b.height-E.height&&(E.y+=t)};let U=!1,q=!1,D=!1,R=!1,G=0,N=0,z=!1,J=0;const K=()=>{if(E=k[0].props,!x(E.hp,Z,G))if(Q)requestAnimationFrame(K);else{v.clearRect(0,0,b.width,b.height),z?f.stop():f.play(),$w(".health").html(`HP:${E.hp}`),$w(".health").attr("style","color: #0f380f"),G+=1,$w(".score").html(G+""),C++,S>=11&&(S=0),(J+=1)%3==0&&++S,q?(P.x=E.x-18,P.y=E.y-E.height/2,P.cropX=64*S,P.render()):U?(M.x=E.x-6,M.y=E.y-E.height/2,M.cropX=64*S,M.render()):(I.x=E.x-12,I.y=E.y-E.height/2,I.cropX=64*S,I.render()),W.x=B[0].x-(B[0].width/2-5),W.y=B[0].y,C>=12&&246===W.cropY?(C=0,W.cropY=117):C>=12&&117===W.cropY&&(C=0,W.cropY=246),W.render(),w(N,b,H,k[0]),N+=1;let t=X[0],e=B[0],i=$[0];G<4e4?(console.log("yo"),e.update([0,2]),t.update([0,3]),_(),T(),i.update([1.9,.5]),k[0].bullets.forEach(e=>{G=i.killed($,G,b,E,e,k[0].bullets).score,G=t.killed(X,G,b,E,e,k[0].bullets).score}),j(4)):G>=4e4&&(e.update([0,2.5]),t.update([0,3.5]),_(),T(),i.update([3,1]),k[0].bullets.forEach(e=>{G=i.killed($,G,b,E,e,k[0].bullets).score,G=t.killed(X,G,b,E,e,k[0].bullets).score}),j(6)),k[0].bullets.forEach(t=>{G=e.killed(B,G,b,E,t,k[0].bullets).score}),G=e.playerHit(E,B,G),G=t.playerHit(E,X,G),G=i.playerHit(E,$,G),G=e.died(B,G,b),G=t.died(X,G,b),G=i.died($,G,b),k[0].draw(),k[0].fire(),k[0].reload(),G>4e4?$w("#myCanvas").attr("style","background: url('./assets/sky-pink.png"):G>6e4?$w("#myCanvas").attr("style","background: purple"):G>4e5&&$w("#myCanvas").attr("style","background: black"),requestAnimationFrame(K)}};document.addEventListener("keydown",function(t){39===t.keyCode?(t.preventDefault(),U=!0):37===t.keyCode?(t.preventDefault(),q=!0):38===t.keyCode?(t.preventDefault(),D=!0):40===t.keyCode?(t.preventDefault(),R=!0):13===t.keyCode?(t.preventDefault(),Q=!Q,$w(".start-menu").toggleClass("hidden"),V&&$w(".start-menu").html("Pause")):83===t.keyCode&&(z=!z)},!1),document.addEventListener("keyup",function(t){39===t.keyCode?U=!1:37===t.keyCode?q=!1:38===t.keyCode?D=!1:40===t.keyCode&&(R=!1)},!1);let Q=!0;var V=!0;const Z=requestAnimationFrame(K)}]);